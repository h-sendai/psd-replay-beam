名前

psd_replay - NEUNETエミュレータ

使用方法

./psd_replay [-d] [-p port] datafile

説明

既にあるdatafileを読んでNEUNETのようにふるまうサーバーです。
データの読み書きはNETNETと同じプロトコルです(クライアントが
長さリクエストを出し、サーバーはデータ送り出しの前に、まず
これから送るデータ長を送る方式)。

NEUNETはport 23を使用しますが、一般のUnixではport 23を使用
するにはroot権限が必要になるので、port 23456でlistenするように
しました。-p portでlistenするポートを変更することが可能です。

datafileはどこかで実際に取得したデータファイルを利用するのが
簡単です。T0データはこのエミュレータでは発生させることが
できません。T0データはdatafileにすでに入っている必要が
あります。

datafileを読み終わったらlength 0をクライアントに返し続けます。

オプション

-d      デバッグ出力を標準エラー出力に出す。

-p port ポート番号portでlisten()する。指定しなかった場合の
        デフォルトは23456。

バグ

データファイルがないとなにもできない。イベントデータの生成は
どうにかなるかもしれないが、T0データの挿入はむずかしそう。

プログラムのバグではありませんが付属のMakefileは作者の趣味
でBSD makeの文法で書いてあります。

ファイルを読み終わったあとの動作。今はフラグを使ってEOFに
なったあとはread()しないようにしているが、EOFに達したファイル
を何度read()しても0が返ってくるだけでブロックなどしないので
read()させてその戻り値0をlengthとしてクライアントに送るほうが
フラグを使わなくてすむのでコードがすっきりするかもしれない。
が無意味にread()させるとシステムコール代が高くつくかもしれない。

想定されている利用目的

すでに性質がわかっているデータを利用してオンラインモニターの
使用感のテストなどに利用する。

作者

千代浩司

変更履歴

* 2008-04-05
    - 第1版。とりあえず書いてみた。
    - lengthとdataで2回write()していたのをwritev()で1回にした。

